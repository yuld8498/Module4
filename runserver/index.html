<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Document</title>
    <link rel="stylesheet" href="/style.css">
    <link rel="stylesheet" href="/banking-ajax/boostrap/sweetalert2/sweetalert2.min.css">
    <link rel="stylesheet" href="/banking-ajax/boostrap/css/bootstrap.min.css">
</head>

<body class="position-relative">
    <div class="table container">
        <div class="table-header">
            <div class="bg-info table-title">
                <div class="row">
                    <div class="col-5 table-title-content">
                        <h1>List Of Customer</h1>
                    </div>
                    <div class="col-7 table-title-content">
                        <div class="col-lg-5 float-right">
                            <button class="btn btn-outline-light mt-2" data-toggle="modal" data-target="#mdCreate">
                                <i class="fa-solid fa-square-plus"></i>
                                <span>Add New Customer</span>
                            </button>
                        </div>
                        <div class="col-lg-7 float-left">
                            <a href="/customer/transfer" class="btn btn-outline-light float-right mt-2">
                                <i class="fa-solid fa-clock-rotate-left"></i>
                                <span>Transfer Money Infomation</span>
                            </a>
                        </div>
                    </div>
                </div>
            </div>
        </div>
        <div class="content">
            <div class="table-tab">
                <table class="w-100" id="table">
                    <thead class="w-100 border-none align-middle" style="background-color: #4CAF50">
                        <tr class="float-center">
                            <th>#</th>
                            <th>Full Name</th>
                            <th>Email</th>
                            <th>Phone</th>
                            <th>Address</th>
                            <th>Balance</th>
                            <th colspan="5" class="text-center">Action</th>
                        </tr>
                    </thead>
                    <tbody class="w-100 align-middle">
                    </tbody>
                </table>
            </div>
        </div>
    </div>
    <!-- Model Create -->
    <div class="modal fade " id="mdCreate" tabindex="-1" data-backdrop="static" data-keyboard="false">
        <div class="modal-dialog modal-dialog-centered modal-lg">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title" id="exampleModalLabel">Create Customer</h5>
                    <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                        <span aria-hidden="true">&times;</span>
                    </button>
                </div>
                <div class="modal-body">
                    <div class="modal-alert-danger hide">
                    </div>
                    <form id="frmTransfer">
                        <div class="row">
                            <div class="col-lg-6">
                                <input type="text" id="customerId" name="customerId" class="form-control" hidden>
                                <label for="fullName">Full Name</label>
                                <input type="text" id="fullName" name="fullName" class="form-control">
                            </div>
                            <div class="col-lg-6">
                                <label for="email">Email</label>
                                <input type="email" id="email" name="email" class="form-control">
                            </div>
                            <div class="col-lg-6">
                                <label for="phone">Phone Number</label>
                                <input type="tel" id="phone" name="phone" class="form-control">
                            </div>
                            <div class="col-lg-6">
                                <label for="phone">Address</label>
                                <input type="text" id="address" name="address" class="form-control">
                            </div>
                        </div>
                    </form>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-outline-secondary" data-dismiss="modal">Close</button>
                    <button type="button" id="btnCreate" class="btn btn-outline-primary">Create Customer</button>
                </div>
            </div>
        </div>
    </div>

    <!--Model Update-->

    <div class="modal fade " id="mdUpdate" tabindex="-1" data-backdrop="static" data-keyboard="false">
        <div class="modal-dialog modal-dialog-centered modal-lg">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title" id="exampleModalLabel">Update Customer</h5>
                    <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                        <span aria-hidden="true">&times;</span>
                    </button>
                </div>
                <div class="modal-body">
                    <div class="modal-alert-danger hide">
                    </div>
                    <form id="frmTransfer">
                        <div class="row">
                            <div class="col-lg-6">
                                <input type="text" id="customerIdUp" name="customerIdUp" class="form-control" hidden>
                                <label for="fullNameUp">Full Name</label>
                                <input type="text" id="fullNameUp" name="fullNameUp" class="form-control">
                            </div>
                            <div class="col-lg-6">
                                <label for="emailUp">Email</label>
                                <input type="email" id="emailUp" name="emailUp" class="form-control">
                            </div>
                            <div class="col-lg-6">
                                <label for="phoneUp">Phone Number</label>
                                <input type="tel" id="phoneUp" name="phoneUp" class="form-control">
                            </div>
                            <div class="col-lg-6">
                                <label for="addressUp">Address</label>
                                <input type="text" id="addressUp" name="addressUp" class="form-control">
                            </div>
                        </div>
                    </form>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-outline-secondary" data-dismiss="modal">Close</button>
                    <button type="button" id="btnUpdateCustomer" class="btn btn-outline-primary">Update
                        Customer</button>
                </div>
            </div>
        </div>
    </div>
    <!-- Model Deposit -->
    <div class="modal fade " id="mdDeposits" tabindex="-1" data-backdrop="static" data-keyboard="false">
        <div class="modal-dialog modal-dialog-centered modal-lg">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title" id="exampleModalLabel">Modal Deposit</h5>
                    <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                        <span aria-hidden="true">&times;</span>
                    </button>
                </div>
                <div class="modal-body">
                    <div class="modal-alert-danger hide">
                    </div>
                    <form id="frmDeposit">
                        <div class="row">
                            <div class="col-lg-6">
                                <input type="hidden" id="customerIdDe" name="customerIdDe">
                                <label for="fullNameDe">Full Name</label>
                                <input type="text" id="fullNameDe" readonly class="form-control">
                            </div>
                            <div class="col-lg-6">
                                <label for="emailDe">Email</label>
                                <input type="email" id="emailDe" name="emailDe" class="form-control" readonly>
                            </div>
                        </div>
                        <div class="row mt-3">
                            <div class="col-lg-6">
                                <label for="balanceDe">Balance</label>
                                <input type="text" id="balanceDe" readonly class="form-control">
                            </div>
                            <div class="col-lg-6">
                                <label for="transactionAmount">Transaction Amount</label>
                                <input type="text" id="transactionAmount" name="transactionAmount" class="form-control">
                            </div>
                        </div>
                    </form>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-outline-secondary" data-dismiss="modal">Close</button>
                    <button type="button" id="btnDeposits" class="btn btn-outline-success">Deposits</button>
                </div>
            </div>
        </div>
    </div>
    <!-- Model Withdraw -->
    <div class="modal fade " id="mdWithdraw" tabindex="-1" data-backdrop="static" data-keyboard="false">
        <div class="modal-dialog modal-dialog-centered modal-lg">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title" id="exampleModalLabel">Withdraw</h5>
                    <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                        <span aria-hidden="true">&times;</span>
                    </button>
                </div>
                <div class="modal-body">
                    <div class="modal-alert-danger hide">
                    </div>
                    <form id="frmWithdraw">
                        <div class="row">
                            <div class="col-lg-6">
                                <input type="hidden" id="customerIdWd">
                                <label for="fullName">Full Name</label>
                                <input type="text" id="fullNameWd" readonly class="form-control">
                            </div>
                            <div class="col-lg-6">
                                <label for="email">Email</label>
                                <input type="email" id="emailWd" name="emailDe" class="form-control" readonly>
                            </div>
                        </div>
                        <div class="row mt-3">
                            <div class="col-lg-6">
                                <label for="phone">Balance</label>
                                <input type="text" id="balanceWd" readonly class="form-control">
                            </div>
                            <div class="col-lg-6">
                                <label for="transactionAmount">Transaction Amount ($)</label>
                                <input type="text" id="transactionAmountWd" name="transactionAmountWd"
                                    class="form-control">
                            </div>
                        </div>
                    </form>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-outline-secondary" data-dismiss="modal">Close</button>
                    <button type="button" id="btnWithdraw" class="btn btn-outline-warning">Withdraw</button>
                </div>
            </div>
        </div>
    </div>
    <!-- Model Transfer -->
    <div class="modal fade " id="mdTransfer" tabindex="-1" data-backdrop="static" data-keyboard="false">
        <div class="modal-dialog modal-dialog-centered modal-lg">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title" id="exampleModalLabel">Transfer</h5>
                    <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                        <span aria-hidden="true">&times;</span>
                    </button>
                </div>
                <div class="modal-body">
                    <div class="modal-alert-danger hide">
                    </div>
                    <form id="frmTransfer">
                        <div class="row">
                            <div class="col-lg-3">
                                <input type="hidden" id="customerIdT">
                                <label for="fullName">Sender ID</label>
                                <input type="text" id="senderId" readonly class="form-control">
                            </div>
                            <div class="col-lg-3">
                                <input type="hidden" id="customerIdT">
                                <label for="fullName">Sender Name</label>
                                <input type="text" id="senderName" readonly class="form-control">
                            </div>
                            <div class="col-lg-3">
                                <label for="email">Email</label>
                                <input type="email" id="senderEmail" name="senderEmail" class="form-control" readonly>
                            </div>
                            <div class="col-lg-3">
                                <label for="phone">Sender Balance</label>
                                <input type="text" id="senderBalance" readonly class="form-control">
                            </div>
                        </div>
                        <div class="row mt-3">
                            <div class="col-lg-3">
                                <!-- <input type="hidden" id="recipientId"> -->
                                <label for="phone">Recipient Name</label>
                                <select type="select" id="recipientId" class="form-control">
                                </select>
                            </div>
                            <div class="col-lg-3">
                                <label for="transferAmount">Transfer Amount ($)</label>
                                <input type="text" id="transferAmount" name="transferAmount" class="form-control">
                            </div>
                            <div class="col-lg-3">
                                <label for="fees">Fees(%)</label>
                                <input type="text" id="fees" name="fees" class="form-control" readonly value=10>
                            </div>
                            <div class="col-lg-3">
                                <label for="totalAmount">Total amount($)</label>
                                <input type="text" id="totalAmount" name="totalAmount" class="form-control" readonly>
                            </div>
                        </div>
                    </form>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-outline-secondary" data-dismiss="modal">Close</button>
                    <button type="button" id="btnTransfer" class="btn btn-outline-primary">Transfer</button>
                </div>
            </div>
        </div>
    </div>
    <div>
        <!-- <script src="/index.js"></script> -->
        <!-- <script src="/js.js"></script> -->
        <script src="/app.js"></script>
        <script src="/banking-ajax/boostrap/js/jquery-3.6.0.js"></script>
        <script src="/banking-ajax/boostrap/sweetalert2/sweetalert2.min.js"></script>
        <script src="/banking-ajax/boostrap/js/bootstrap.min.js"></script>
        <script src="/banking-ajax/boostrap/js/bootstrap.bundle.min.js"></script>
        <script src="/banking-ajax/boostrap/js/popper-v1.16.0.min.js"></script>
        <script src="https://kit.fontawesome.com/dccec83b30.js" crossorigin="anonymous"></script>


        <script>
            let customer = new Customer();
            let check = false;
            let newCustomer = new Customer();
            function loadCustomer() {
                let str = '';
                $.ajax({
                    headers: {
                        Accept: 'application/json',
                        contentType: 'application/json'
                    },
                    url: "http://localhost:3000/customers?deleted=0",
                    type: "GET",
                }).done((data) => {
                    $.each(data, (i, item) => {
                        drawItem(item);
                    });
                    // unbindAll();
                    handleGroupShowModal();
                });
            };

            function findCustomerById(id) {
                return $.ajax({
                    Headers: {
                        "contentType": "application/json",
                        "Accept": "application/json; charset=utf-8",
                    },
                    url: "http://localhost:3000/customers/" + id,
                    type: "GET"
                }).done((data) => {
                    customer = data;
                }).fail((error) => {
                    console.log(error);
                })
            }


            function drawItem(item) {
                let str =
                    `<tr id="tr_${item.id}">
            <td class="id">${item.id}</td>
            <td class="fullName">${item.fullName}</td>
            <td class="email">${item.email}</td>
            <td class="phone">${item.phone}</td>
            <td class="address">${item.address}</td>
            <td class="balance">${item.balance}</td>
            <td class="text-center">
                <button 
                    class="btnUpdateCustomer fa-solid fa-pen-to-square border-1-radius text-color-blue deposit-hover text-decoration-none Edit"
                    data-toggle="tooltip" data-id ="${item.id}" data-placement="top" title="Edit">
                </button>
            </td>
            <td class="text-center">
                <button 
                    class="btnDeposits fa-solid fa-plus border-1-radius text-color-blue deposit-hover text-decoration-none deposit"
                    data-toggle="tooltip" data-id ="${item.id}" data-placement="top" title="Deposit">
                </button>
            </td>
            <td class="text-center">
                <button 
                    class="btnWithdraw fa-solid fa-minus border-1-radius text-color-yellow withdraw-hover text-decoration-none withdraw"
                    data-toggle="tooltip" data-id ="${item.id}" data-placement="top" title="Withdraw">
                </button>
            </td>
            <td class="text-center">
                <button
                    class="btnTransfer transfer fa-solid fa-arrow-right-arrow-left border-1-radius text-color-blue transfer-hover text-decoration-none"
                    data-toggle="tooltip" data-id ="${item.id}" data-placement="top" title="Transfer">
                </button>
            </td>
            <td class="text-center">
                <button
                    class="btnSuspended suspended fa-solid fa-ban border-1-radius text-color-red suspended-hover text-decoration-none"
                    data-toggle="tooltip" data-id ="${item.id}" data-placement="top" title="Suspended">
                </button>
            </td>
          </tr>`;
                $("#table tbody").prepend(str);
                $(function () {
                    $('[data-toggle="tooltip"]').tooltip();
                });
            }

            function updateCustomer(customer) {
                return $.ajax({
                    url: "http://localhost:3000/customers/" + customer.id,
                    type: "PATCH",
                    data: customer
                })
                    .done((data) => {
                        customer;
                    })
                    .fail((error) => {
                        console.log(error);
                    })
            };

            function rewrite(customer) {
                let currentRow = $('#tr_' + customer.id);
                let updateRow = ` <tr id="tr_${customer.id}">
                <td class="id">${customer.id}</td>
            <td class="fullName">${customer.fullName}</td>
            <td class="email">${customer.email}</td>
            <td class="phone">${customer.phone}</td>
            <td class="address">${customer.address}</td>
            <td class="balance">${customer.balance}</td>
            <td class="text-center">
                <button 
                    class="btnUpdateCustomer fa-solid fa-pen-to-square border-1-radius text-color-blue deposit-hover text-decoration-none Edit"
                    data-toggle="tooltip" data-id ="${customer.id}" data-placement="top" title="Edit">
                </button>
            </td>
            <td class="text-center">
                <button 
                    class="btnDeposits fa-solid fa-plus border-1-radius text-color-blue deposit-hover text-decoration-none deposit"
                    data-toggle="tooltip" data-id ="${customer.id}" data-placement="top" title="Deposit">
                </button>
            </td>
            <td class="text-center">
                <button 
                    class="btnWithdraw fa-solid fa-minus border-1-radius text-color-yellow withdraw-hover text-decoration-none withdraw"
                    data-toggle="tooltip" data-id ="${customer.id}" data-placement="top" title="Withdraw">
                </button>
            </td>
            <td class="text-center">
                <button
                    class="btnTransfer transfer fa-solid fa-arrow-right-arrow-left border-1-radius text-color-blue transfer-hover text-decoration-none"
                    data-toggle="tooltip" data-id ="${customer.id}" data-placement="top" title="Transfer">
                </button>
            </td>
            <td class="text-center">
                <button
                    class="btnSuspended suspended fa-solid fa-ban border-1-radius text-color-red suspended-hover text-decoration-none"
                    data-toggle="tooltip" data-id ="${customer.id}" data-placement="top" title="Suspended">
                </button>
            </td>
            </tr>`;
                currentRow.replaceWith(updateRow);
                unbindAll();
                handleGroupShowModal();
            }

            loadCustomer();

            //create a customer
            $("#btnCreate").on('click', function () {
                customer.fullName = $("#fullName").val();
                customer.email = $("#email").val();
                customer.phone = $("#phone").val();
                customer.address = $("#address").val();
                customer.deleted = 0;
                customer.balance = 0;

                let emails = document.getElementsByClassName("email");
                if (customer.fullName == "" || customer.email == ""
                    || customer.phone == "" || customer.address == "") {
                    App.showErrorAlert("Please enter all of fields")
                    return;
                }
                for (var i = 0; i < emails.length; i++) {
                    if (emails[i].innerHTML == customer.email) {
                        return App.showErrorAlert("Email already exists")
                    }
                }
                $.ajax({
                    type: "POST",
                    url: "http://localhost:3000/customers",
                    headers: {
                        'Accept': 'application/json',
                        'Content-Type': 'application/json'
                    },
                    data: JSON.stringify(customer),
                })
                    .done((item) => {
                        // customer = item;
                        App.showSuccessAlert("Create new customer is successfully");
                        $("#mdCreate").modal("hide");

                        // $("#table tbody").prepend($(tempCustomer(customer.id, customer.fullName, customer.email, customer.phone, customer.address, customer.balance)));
                        drawItem(item);
                        unbindAll();
                        handleGroupShowModal();
                    })
                    .fail((error) => {
                        App.showErrorAlert("Create new customer is failed")
                    });
            });

            //Edit customer information
            $("#btnUpdateCustomer").on('click', function () {

                $("#emailUp").on('change', function () {
                    check = false;
                })

                if ($("#emailUp").val() != customer.email) {
                    existsEmail($("#emailUp").val()).then((result) => {
                        if (check == true) {
                            App.showErrorAlert("Email already Exists");
                        } else {
                            customer.id = $("#customerIdUp").val();
                            customer.fullName = $("#fullNameUp").val();
                            customer.email = $("#emailUp").val();
                            customer.phone = $("#PhoneUp").val();
                            customer.address = $("#AddressUp").val();
                            $.ajax({
                                headers: {
                                    Accept: 'application/json',
                                    contentType: 'application/json; charset=utf-8'
                                },
                                url: 'http://localhost:3000/customers/' + customer.id,
                                type: 'PATCH',
                                data: customer
                            }).done((data) => {
                                rewrite(customer);
                                App.showSuccessAlert("Update is successfully")
                                $("#mdUpdate").modal("hide");
                            }).fail((error) => {
                                App.showErrorAlert("Update is fail, please try again later")
                            })
                        }
                    })
                } else {
                    customer.id = $("#customerIdUp").val();
                    customer.fullName = $("#fullNameUp").val();
                    customer.email = $("#emailUp").val();
                    customer.phone = $("#PhoneUp").val();
                    customer.address = $("#AddressUp").val();
                    $.ajax({
                        headers: {
                            Accept: 'application/json',
                            contentType: 'application/json; charset=utf-8'
                        },
                        url: 'http://localhost:3000/customers/' + customer.id,
                        type: 'PATCH',
                        data: customer
                    }).done((data) => {
                        rewrite(customer);
                        App.showSuccessAlert("Update is successfully")
                        $("#mdUpdate").modal("hide");
                    }).fail((error) => {
                        App.showErrorAlert("Update is fail, please try again later")
                    })
                }
            })

            //Deposit balance
            $("#btnDeposits").on('click', function () {
                let customerId = $("#customerIdDe").val();
                let transactionAmount = $("#transactionAmount").val();
                if (Number.isNaN(+transactionAmount)) {
                    App.showErrorAlert("'" + transactionAmount + "' is not a number, please enter a number!");
                } else if (+ transactionAmount < 1000) {
                    App.showErrorAlert("transaction Amount is greater than 1000");
                }
                else {
                    $.ajax({
                        type: "GET",
                        "url": "http://localhost:3000/customers/" + customerId,
                    })
                        .done((data) => {
                            customer = data;
                            console.log(customer.id);
                            customer.balance = (+customer.balance) + (+transactionAmount);
                            console.log(customer);
                            $.ajax({
                                type: "PATCH",
                                url: "http://localhost:3000/customers/" + customerId,
                                data: customer,
                            })
                                .done((data) => {
                                    $('#mdDeposits').modal('hide');
                                    App.showSuccessAlert("Deposit is successfully");
                                    rewrite(customer);

                                }).fail((error) => {
                                    App.showErrorAlert("Deposit is fail");
                                })
                        })
                        .fail((error) => {
                            App.showErrorAlert("Deposit is fail, please try again later");
                        })
                }
            });

            //withdraw money
            $("#btnWithdraw").on('click', function () {
                customer.id = $("#customerIdWd").val();
                let transactionAmount = $("#transactionAmountWd").val();
                if (Number.isNaN(+transactionAmount)) {
                    App.showErrorAlert("'" + transactionAmount + "' is not a number, please enter a number!");
                } else if (+ transactionAmount < 100) {
                    App.showErrorAlert("transaction Amount is greater than 100");
                }
                else if (+ transactionAmount > $("#balanceWd").val()) {
                    App.showErrorAlert("transaction Amount is less than balance");
                }
                else {
                    $.ajax({
                        type: "GET",
                        "url": "http://localhost:3000/customers/" + customer.id
                    }).done((data) => {
                        customer = data;
                        customer.balance = +(customer.balance) - +(transactionAmount);
                        $.ajax({
                            type: "PATCH",
                            "url": "http://localhost:3000/customers/" + customer.id,
                            data: customer
                        }).done((data) => {
                            customer = data;
                            rewrite(customer);
                            App.showSuccessAlert("Withdraw is successfully");
                            $("#mdWithdraw").modal("hide");
                        }).fail((error) => {
                            App.showErrorAlert("Withdraw is fail");
                        })
                    }).fail((error) => {
                        App.showErrorAlert("Withdraw is fail");
                    })
                }
            });

            //Transfer
            $("#btnTransfer").on('click', function () {
                let sender = new Customer();
                let recipient = new Customer();
                let senderId = $("#senderId").val();
                let recipientId = $("#recipientId").val();
                let transferAmount = +($("#transferAmount").val());
                let total = transferAmount + transferAmount * 0.1;
                if (transferAmount < 50) {
                    App.showErrorAlert("Transfer amount is greater than 50");
                    return;
                }
                findCustomerById(senderId).then((data) => {
                    sender = data;
                    if (sender.balance < total) {
                        App.showErrorAlert("The sender's balance is not enough to make the transfer");
                        return;
                    };
                    findCustomerById(recipientId).then((data) => {
                        recipient = data;
                        sender.balance = (+(sender.balance) - total);
                        recipient.balance = (+(recipient.balance) + transferAmount);
                        updateCustomer(sender).then((data) => {
                            updateCustomer(recipient).then(() => {
                                rewrite(sender);
                                rewrite(recipient);
                                App.showSuccessAlert("Transfer is successfully");
                                $("#mdTransfer").modal("hide");
                                console.log(JSON.stringify(sender));
                                console.log(JSON.stringify(recipient));
                            }).catch(() => {
                                sender.balance = (+(sender.balance) + transferAmount);
                                updateCustomer(sender);
                                App.showErrorAlert("Transfer is failed, please try again later")
                            })
                        }).catch(() => {
                            App.showErrorAlert("Transfer is failed, please try again later")
                        })
                    }).catch(() => {
                        App.showErrorAlert("can't find Sender id, please check input again.")
                    });

                }).catch(() => {
                    App.showErrorAlert("can't find sender id, please check input again.")
                });
            });

            function handleGroupShowModal() {
                showBoxDeposit();
                showBoxWithdraw();
                showBoxSuspended();
                showBoxTransfer();
                showBoxUpdate();
            };

            function unbindAll() {
                $('.btnUpdateCustomer').off('click');
                $('.btnDeposits').off('click');
                $('.btnWithdraw').off('click');
                $('.btnTransfer').off('click');
                $('.btnCreate').off('click');
            };

            function showBoxDeposit() {
                $('.btnDeposits').on('click', function () {
                    let id = $(this).data('id');
                    $.ajax({
                        "type": "GET",
                        "url": "http://localhost:3000/customers/" + id
                    })
                        .done((data) => {
                            $('#customerIdDe').val(data.id);
                            $('#fullNameDe').val(data.fullName);
                            $('#emailDe').val(data.email);
                            $('#balanceDe').val(data.balance);

                            $('#mdDeposits').modal('show');
                        })
                        .fail((error) => {
                            App.SweetAlert.showAlertError('Invalid ID customer');
                        })
                });
            };

            function showBoxUpdate() {
                $('.btnUpdateCustomer').on('click', function () {
                    let id = $(this).data('id');
                    findCustomerById(id).then((data) => {
                        $('#customerIdUp').val(data.id);
                        $('#fullNameUp').val(data.fullName);
                        $('#emailUp').val(data.email);
                        $('#phoneUp').val(data.phone);
                        $('#addressUp').val(data.address);
                        $('#mdUpdate').modal('show');
                    })
                });
            };

            //showCreateForm
            function showBoxCreate() {
                $("#mdCreate").modal("show");
            };

            function showBoxTransfer() {
                $('.btnTransfer').on('click', function () {
                    console.log("a");
                    let id = $(this).data('id');
                    $.ajax({
                        "type": "GET",
                        "url": "http://localhost:3000/customers/" + id
                    })
                        .done((data) => {
                            $('#senderId').val(data.id);
                            $('#senderName').val(data.fullName);
                            $('#senderEmail').val(data.email);
                            $('#senderBalance').val(data.balance);
                            $('#mdTransfer').modal('show');
                            $.ajax({
                                type: "GET",
                                url: "http://localhost:3000/customers?deleted=0",
                            }).done((data) => {
                                let str = "<option value=0>-- Recipient --</option>";
                                $.each(data, (j, item) => {
                                    if ($(this).data('id') != item.id) {
                                        str += `<option value="${item.id}">(${item.id})${item.fullName}</option>`;
                                    }
                                });
                                document.getElementById("recipientId").innerHTML = str;
                                totalAmount();
                            }).fail((error) => {
                                App.showErrorAlert("Can't find recipient name")
                            })
                        })
                        .fail((error) => {
                            App.SweetAlert.showAlertError('Invalid ID customer');
                        })
                });
            };

            function showBoxWithdraw() {
                $('.btnWithdraw').on('click', function () {
                    let id = $(this).data('id');
                    $.ajax({
                        "type": "GET",
                        "url": "http://localhost:3000/customers/" + id
                    })
                        .done((data) => {
                            $('#customerIdWd').val(data.id);
                            $('#fullNameWd').val(data.fullName);
                            $('#emailWd').val(data.email);
                            $('#balanceWd').val(data.balance);

                            $('#mdWithdraw').modal('show');
                        })
                        .fail((error) => {
                            App.SweetAlert.showAlertError('Invalid ID customer');
                        })
                });
            };

            function showBoxSuspended() {
                $('.btnSuspended').on('click', function () {
                    let id = $(this).data('id');
                    App.showDeleteConfirmDialog()
                        .then((result) => {
                            if (result.isConfirmed) {
                                findCustomerById(id).then((result => {
                                    customer.deleted = 1;
                                    $.ajax({
                                        "type": "PATCH",
                                        "url": "http://localhost:3000/customers/" + id,
                                        "data": customer
                                    })
                                        .done((data) => {
                                            $('#tr_' + id).remove();
                                            App.showSuccessAlert('The customer has been deactived');
                                        })
                                        .fail((error) => {
                                            App.SweetAlert.showAlertError('Deactive customer fail');
                                        });
                                })
                                )
                            }
                        })

                });
            };

            //check email exists
            function existsEmail(email) {
                return $.ajax({
                    headers: {
                        Accept: 'application/json',
                        contentType: 'application/json'
                    },
                    type: "GET",
                    url: "http://localhost:3000/customers?deleted=0&email=" + email
                }).done((data) => {
                    if (data[0] != null) {
                        check = true;
                    }
                }).fail((error) => {
                    console.log(error);
                })
            }

            function totalAmount() {
                let tA;
                let total;
                $("#transferAmount").on('keyup', function () {
                    tA = $("#transferAmount").val();
                    total = +tA + tA * 0.1;
                    document.getElementById("totalAmount").value = total;
                })
            }

        </script>
    </div>
</body>


</html>